---
categories: ''
tags:
  - 项目
description: ''
permalink: notion-use-center/
title: 用户中心项目
cover: 'https://blog-images-1318739330.cos.ap-shanghai.myqcloud.com/cf7886353d2d0abad46140c104127a75.jpg'
date: '2024-09-06 09:14:00'
updated: '2024-10-19 19:23:00'
---

# 遇到的问题


## mybatis与mybatis-plus冲突

- `NoSuchMethodError:`

	`org.apache.ibatis.session.Configuration.setArgNameBasedConstructorAutoMapping(Z)` 这个错误表示 `setArgNameBasedConstructorAutoMapping` mybatis中这个方法不存在 

	- 将mybatis依赖删除或者更换mybatis依赖版本，与mybatis-plus依赖适配

## maven无法下载依赖

- 本地仓库中下载的依赖不成功，只出现 `.lastUpdated` 后缀文件，原因是网络问题

![image.png](https://blog-images-1318739330.cos.ap-shanghai.myqcloud.com/12058b8f65cd82c3dc5fd9a0932a131e.png)

- 将IP地址和DNS服务器地址设置为自动获得

## Java实体类的属性存入到数据库中自动转换为 `下划线` 格式

- 配置示例

```yaml
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
```

- 默认属性值为 `true` ，启动自动转换为下划线格式

# 插件使用


## mybatisX插件的使用

- 自动生成数据库相关配置文件
- 右键需要生成的数据库表，选择 `MybatisX-Generator`

![image.png](https://blog-images-1318739330.cos.ap-shanghai.myqcloud.com/9a5e0b138d696229fa8f407b4b79c125.png)


![image.png](https://blog-images-1318739330.cos.ap-shanghai.myqcloud.com/15abc2a395171f78769065cbbafa724d.png)


## GenerateAllSetter插件使用

- 当实体类中的属性太多，手动赋值很麻烦，使用 `GenerateAllSetter` 插件自动生成setter方法

![image.png](https://blog-images-1318739330.cos.ap-shanghai.myqcloud.com/f0486f32e5044235e9bd4286b9400eec.png)

- 选择需要自动生成setter方法的实体类，按住 `Alt + Enter` ，选择不带默认值或者带默认值

## Auto-filling-java-call-arguments自动填充属性名

- 在方法的括号中按 `Alt + Enter` ，点击 `auto fill call parameters` ，自动补充属性名

![image.png](https://blog-images-1318739330.cos.ap-shanghai.myqcloud.com/923c0ffc6359b61f9497b3b1dd7b0b12.png)


# 工具类库


## 字符串工具类

- 导入依赖

```xml
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-lang3</artifactId>
    <version>3.10</version>
</dependency>
```

- 使用 `StringUtils`库
- `StringUtils.isAnyBlank(s1, s2, ...)`判断多个属性值是否为 `null、空字符串、空白字符`

## 加密


```java
	final String SALT = "may";  // 盐
	String encryptPassword = DigestUtils.md5DigestAsHex((SALT + password).getBytes());
```

- `DigestUtils` 是 ``org.springframework.util` 库的工具类

# 注册逻辑

1. 用户在前端输入账号、密码以及校验码
2. 检验用户的账号、密码、校验密码是否符合要求
- 非空
- 账号长度不小于4位
- 密码不小于8位
- 账号不包含特殊字符
- 账号不能重复
- 密码和校验密码相同
1. 对密码进行加密
2. 向数据库插入用户数据

# 登录接口

- 接受参数：用户账号、密码
- 请求类型：POST
- 请求体：JSON格式的数据
- 返回值：用户信息（脱敏）

# 如何知道是哪个用户登录？

1. 连接服务器，得到一个session状态（匿名状态），返回给前端
2. 登录成功后，得到登录成功的session状态，并且给session设置一些值（比如用户信息），返回给前端一个设置cookie的“命令”
3. 前端接受到后端的命令后，设置cookie，保存到浏览器中
4. 前端再次请求后端的时候（相同的域名），在请求头中带上cookie去请求
5. 后端拿到前端传来的cookie，找到对应的session
6. 后端从session中可以取出基于该session存储的变量（用户的登录信息、登录名）

# 登录逻辑

1. 用户在前端输入账号、密码
2. 检验用户的账号、密码是否符合要求
- 非空
- 账号长度不小于4位
- 密码不小于8位
- 账号不包含特殊字符
1. 对密码进行加密
2. 根据账号和密码（加密后的密码）在数据库中查询用户信息
3. 返回的用户信息进行脱敏（隐藏敏感信息，防止数据库中的字段泄露）
4. 记录用户的登录态（session），将其存储到服务器上（使用后端SpringBoot封装的服务器tomcat记录）
5. 返回脱敏后的用户信息

# Mybatis-plus框架


## 逻辑删除

- 在数据库中定义一条isDelete字段，0表示逻辑未删除，1表示逻辑删除，
- 作用：防止恶意删除，方便开发者查看数据
1. 在 `application.yml` 中配置Mybatis-plus的全局删除属性

```sql
mybatis-plus:
  global-config:
    db-config:
      logic-delete-field: deleted # 全局逻辑删除字段名
      logic-delete-value: 1 # 逻辑已删除值
      logic-not-delete-value: 0 # 逻辑未删除值
```

1. 在实体类中使用 `@TableLogin` 注解

```sql
    /**
     * 是否删除 0-正常
     */
    @TableLogic
    private Integer isDelete;
```


# 控制层Controller封装请求


```sql
@RestController 适用于编写 restful 风格的api，返回值默认为 json 类型
```

- controller层倾向于对请求参数本身的校验，不涉及业务逻辑本身（越少越好）
- service层是对业务逻辑的校验（有可能被controller之外的类调用）

## 处理前端返回的数据

- 前端返回的数据为json类型
- 创建新的类解析返回的数据

```sql
@Data
public class UserLoginRequest implements Serializable {

    private String account;
    private String password;
}
```

- `@RequestBody` 注解可以将前端传入的数据和Java实体类进行绑定
